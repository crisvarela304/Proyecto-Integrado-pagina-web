{% extends 'base.html' %}
{% load humanize %}

{% block title %}{{ page_title }}{% endblock %}

{% block content %}
<div class="container py-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h3 fw-bold text-primary mb-0">Gestión de Cursos</h1>
            <p class="text-muted small mb-0">Administración de niveles y aulas</p>
        </div>
        <div>
            <a href="{% url 'administrativo:dashboard' %}" class="btn btn-outline-secondary btn-sm me-2">
                <i class="bi bi-arrow-left"></i> Volver
            </a>
            <a href="{% url 'administrativo:curso_crear' %}" class="btn btn-primary btn-sm shadow-sm">
                <i class="bi bi-plus-circle me-1"></i> Nuevo Curso
            </a>
        </div>
    </div>

    <!-- Filtros y Búsqueda (Visual only for now) -->
    <!-- Filtros y Búsqueda -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-2">
            <form method="get" action="." id="filterForm" class="row g-2 align-items-center">
                <div class="col-auto">
                    <span class="text-muted small ms-2"><i class="bi bi-funnel"></i> Filtrar:</span>
                </div>
                <div class="col-auto">
                    <select name="anio" class="form-select form-select-sm border-0 bg-light"
                        onchange="this.form.submit()">
                        <option value="">Todos los años</option>
                        {% for item in anios_list %}
                        <option value="{{ item.valor }}" {% if item.is_selected %}selected{% endif %}>{{ item.valor }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col">
                    <input type="text" name="q" value="{{ busqueda }}"
                        class="form-control form-control-sm border-0 bg-light"
                        placeholder="Buscar curso por nombre, letra o profesor...">
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-sm btn-primary"><i class="bi bi-search"></i></button>
                    {% if anios_list|length > 0 and busqueda or anios_list|length > 0 %}
                    <!-- Helper logic for clear button: if we have query params. 
                         context has 'busqueda'. 'anio_seleccionado' isn't directly passed as simple bool easily checkable without extra var.
                         But we can just check query params in template from request.GET? 
                         Or just show it always if filtering? 
                         Let's keep it simple. -->
                    <a href="{% url 'administrativo:gestion_cursos' %}" class="btn btn-sm btn-light text-danger"
                        title="Limpiar"><i class="bi bi-x-lg"></i></a>
                    {% endif %}
                </div>
            </form>
        </div>
    </div>

    <!-- Grid de Cursos -->
    <div class="row g-4">
        {% for curso in cursos %}
        <div class="col-12 col-md-6 col-lg-4">
            <div class="card h-100 border-0 shadow-sm hover-lift">
                <div class="card-body position-relative">
                    {% if not curso.activo %}
                    <span class="position-absolute top-0 end-0 badge bg-danger m-3">Inactivo</span>
                    {% endif %}

                    <div class="d-flex align-items-center mb-3">
                        <div class="avatar-circle bg-primary bg-opacity-10 text-primary me-3 fs-4">
                            {{ curso.letra }}
                        </div>
                        <div>
                            <h5 class="fw-bold mb-0 text-dark">{{ curso.nombre }}</h5>
                            <small class="text-muted">{{ curso.get_nivel_display }}</small>
                        </div>
                    </div>

                    <div class="mb-4">
                        <div class="d-flex justify-content-between text-muted small mb-2">
                            <span><i class="bi bi-person-badge me-1"></i>Profesor Jefe:</span>
                            <span class="fw-medium text-dark text-truncate" style="max-width: 150px;">
                                {{ curso.profesor_jefe.get_full_name|default:"Sin asignar" }}
                            </span>
                        </div>
                        <div class="d-flex justify-content-between text-muted small">
                            <span><i class="bi bi-people me-1"></i>Estudiantes:</span>
                            <span class="fw-medium text-dark">{{ curso.total_estudiantes_real }}</span>
                        </div>
                    </div>

                    <div class="d-grid gap-2 d-flex justify-content-between mt-auto pt-3 border-top border-light">
                        <a href="{% url 'administrativo:curso_editar' curso.pk %}"
                            class="btn btn-light btn-sm flex-fill text-muted">
                            <i class="bi bi-pencil me-1"></i> Editar
                        </a>
                        <a href="{% url 'administrativo:curso_eliminar' curso.pk %}"
                            class="btn btn-light btn-sm flex-fill text-danger">
                            <i class="bi bi-trash me-1"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12 text-center py-5">
            <div class="text-muted mb-3"><i class="bi bi-inbox fs-1"></i></div>
            <h5>No hay cursos registrados</h5>
            <p class="text-muted">Comienza creando el primer curso del año escolar.</p>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .hover-lift {
        transition: transform 0.2s;
    }

    .hover-lift:hover {
        transform: translateY(-5px);
    }

    .avatar-circle {
        width: 48px;
        height: 48px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }
</style>
{% endblock %}