{% extends "base.html" %}
{% load crispy_forms_tags %}
{% load static %}

{% block title %}Iniciar sesión - Liceo Juan Bautista{% endblock %}

{% block content %}
<div class="row m-0 min-vh-100 overflow-hidden">
    <!-- Left Side: Image & Branding -->
    <div class="col-lg-6 p-0 d-none d-lg-block position-relative">
        <div style="background-image: url('{% static 'img/login_bg.png' %}'); 
                    background-size: cover; 
                    background-position: center; 
                    height: 100%; 
                    width: 100%;
                    filter: brightness(0.7);">
        </div>
        <div class="position-absolute top-0 start-0 w-100 h-100 d-flex flex-column justify-content-center align-items-center text-white p-5"
            style="background: linear-gradient(135deg, rgba(67, 97, 238, 0.8), rgba(63, 55, 201, 0.6));">
            <div class="text-center animate__animated animate__fadeInUp">
                <i class="fas fa-graduation-cap display-1 mb-4 text-white-50"></i>
                <h1 class="display-4 fw-bold ls-tight mb-3">Liceo Juan Bautista</h1>
                <p class="lead fw-light text-white-50 mb-0">De Hualqui</p>
                <div class="mt-5 border-top border-light border-opacity-25 pt-4">
                    <p class="h5 fw-normal">Plataforma de Gestión Académica</p>
                    <p class="small text-white-50">Acceso exclusivo para comunidad educativa</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Right Side: Login Form -->
    <div class="col-lg-6 d-flex justify-content-center align-items-center bg-white p-4 p-md-5">
        <div class="w-100" style="max-width: 480px;">
            <div class="mb-5 text-center text-lg-start">
                <div class="d-inline-block p-3 rounded-circle bg-light mb-3 text-primary">
                    <i class="fas fa-user-lock fa-2x"></i>
                </div>
                <h2 class="fw-bold mb-1">Bienvenido de nuevo</h2>
                <p class="text-muted">Ingresa tus credenciales para acceder</p>
            </div>

            {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }} alert-dismissible fade show border-0 shadow-sm" role="alert">
                <div class="d-flex align-items-center">
                    <i class="bi bi-info-circle-fill me-2 fs-5"></i>
                    <div>{{ message }}</div>
                </div>
            </div>
            {% endfor %}
            {% endif %}

            <form method="post" id="loginForm" class="needs-validation show-loading">
                {% csrf_token %}
                {{ form|crispy }}

                <div class="d-flex justify-content-between align-items-center mt-3 mb-4">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="remenberMe">
                        <label class="form-check-label user-select-none small text-muted" for="remenberMe">
                            Recordarme
                        </label>
                    </div>
                </div>

                <div class="d-grid gap-3">
                    <button type="submit" class="btn btn-primary btn-lg shadow-sm">
                        <span class="d-flex justify-content-center align-items-center">
                            Iniciar Sesión <i class="bi bi-arrow-right ms-2"></i>
                        </span>
                    </button>
                    <a href="{% url 'home' %}" class="btn btn-light btn-lg text-muted">
                        Cancelar
                    </a>
                </div>
            </form>

            <div class="text-center mt-5">
                <p class="text-muted small mb-0">
                    &copy; {% now "Y" %} Liceo Juan Bautista de Hualqui. <br>Todos los derechos reservados.
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const rutInput = document.getElementById('id_rut_o_username');
        if (!rutInput) return;

        // Enfocar usuario
        rutInput.focus();

        rutInput.addEventListener('input', (event) => {
            let value = event.target.value;
            // Si empieza con número, formatear RUT
            if (/^\d/.test(value)) {
                const clean = value.replace(/[.\-]/g, '').toUpperCase();
                if (clean.length > 1) {
                    const body = clean.slice(0, -1);
                    const dv = clean.slice(-1);
                    const bodyFormatted = body.replace(/\B(?=(\d{3})+(?!\d))/g, '.');
                    value = `${bodyFormatted}-${dv}`;
                } else {
                    value = clean;
                }
                event.target.value = value;
            }
        });
    });
</script>
{% endblock %}